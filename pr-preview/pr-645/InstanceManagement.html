<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to manage your own Spack instance &mdash; C2SM Spack  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Important Spack Commands" href="SpackCommands.html" />
    <link rel="prev" title="C2SM Guidelines for Spack" href="C2SMGuidelines.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            C2SM Spack
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="QuickStart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="C2SMGuidelines.html">C2SM Guidelines for Spack</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to manage your own Spack instance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-new-spack-instance">Create new Spack instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-spack-instance">Update Spack instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clean-spack-instance">Clean Spack instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spack-instance-config-files">Spack instance config files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SpackCommands.html">Important Spack Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CodeDevelopment.html">Develop packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="SpackChoice.html">Why was Spack chosen by MeteoSwiss?</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">C2SM Spack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to manage your own Spack instance</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/InstanceManagement.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-manage-your-own-spack-instance">
<h1>How to manage your own Spack instance<a class="headerlink" href="#how-to-manage-your-own-spack-instance" title="Permalink to this heading"></a></h1>
<p>Users are responsible for their own instance, rather than relying on an
instance installed by C2SM. The main advantage is that users do not make
changes to their Spack instance unless they actively choose to pull upstream
changes from GitHub. Therefore, your workflow is not interrupted, for example,
during a production phase with software installed from Spack.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>With more power comes more responsability!</p>
</div>
<p>This page collects best practices for a safe and reliable Spack instance management.</p>
<section id="create-new-spack-instance">
<h2>Create new Spack instance<a class="headerlink" href="#create-new-spack-instance" title="Permalink to this heading"></a></h2>
<p>To get an instance, clone spack-c2sm and its submodule spack.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone --depth <span class="m">1</span> --recurse-submodules --shallow-submodules -b dev_v0.18.1 https://github.com/C2SM/spack-c2sm.git
</pre></div>
</div>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">--depth</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">--shallow-submodules</span></code> are optional,
but they reduce the amount of downloaded data.</p>
<p>At CSCS, <code class="docutils literal notranslate"><span class="pre">setup-env.sh</span></code> automatically detects the machine. You may simply execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span> spack-c2sm/setup-env.sh
</pre></div>
</div>
<p>It is recommended to clone <code class="docutils literal notranslate"><span class="pre">spack-c2sm</span></code> in a location that does <strong>not</strong> undergo a
regular cleanup. On Piz Daint, <code class="docutils literal notranslate"><span class="pre">$SCRATCH</span></code> enforces the deletion of all files older than 30 days.
This may corrupt your Spack instance, therefore <code class="docutils literal notranslate"><span class="pre">/project/XYZ/</span></code> is a safer location.</p>
</section>
<section id="update-spack-instance">
<h2>Update Spack instance<a class="headerlink" href="#update-spack-instance" title="Permalink to this heading"></a></h2>
<p>To update a Spack instance, pull the latest version from the repository and update the submodules:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git pull
<span class="gp">$ </span>git submodule update --recursive
</pre></div>
</div>
<p>This is required after upgrades at CSCS or if you need new features of a package.
It is recommended to clean the instance afterwards. For more infos, see below.</p>
</section>
<section id="clean-spack-instance">
<h2>Clean Spack instance<a class="headerlink" href="#clean-spack-instance" title="Permalink to this heading"></a></h2>
<p>To clean a Spack instance, empty the caches, uninstall everything and remove misc caches:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack clean -a
<span class="gp">$ </span>spack uninstall -a
<span class="gp">$ </span>rm -rf ~/.spack
</pre></div>
</div>
</section>
<section id="spack-instance-config-files">
<h2>Spack instance config files<a class="headerlink" href="#spack-instance-config-files" title="Permalink to this heading"></a></h2>
<p>There is a set of <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> files that define machine specific things like
compilers, modules, pre-installed packages and more.</p>
<p>They are available under <code class="docutils literal notranslate"><span class="pre">spack/etc/spack</span></code>. Their structure is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code>: all information about available compilers, machine specific compiler flags, module to load (<code class="docutils literal notranslate"><span class="pre">PrgEnv</span></code>) before compiling</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code>: all information about the already installed dependencies, i.e their module names or paths</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modules.yaml</span></code>: all information about the modules created, i.e which env variable or modules should be set once loaded</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>: specifies the main installation path and the main module installation path, where to find binaries etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upstreams.yaml</span></code>: specifies where to find the pre-installed software</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">repos.yaml</span></code>: specifies where to find the only MCH packages that are stored in spack-c2sm repository</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unless your are a Spack developer, there is no need to modify any of the
<code class="docutils literal notranslate"><span class="pre">.yaml</span></code> files listed here.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="C2SMGuidelines.html" class="btn btn-neutral float-left" title="C2SM Guidelines for Spack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SpackCommands.html" class="btn btn-neutral float-right" title="Important Spack Commands" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, C2SM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
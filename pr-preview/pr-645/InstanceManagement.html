

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to manage your own Spack instance &mdash; C2SM Spack  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Important Spack Commands" href="SpackCommands.html" />
    <link rel="prev" title="C2SM Guidelines for Spack" href="C2SMGuidelines.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="index.html">
                C2SM Spack
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="index.html">Docs</a></li>
        
      <li>How to manage your own Spack instance</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="_sources/InstanceManagement.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="QuickStart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="QuickStart.html#at-cscs-daint-tsa-balfrin">At CSCS (Daint, Tsa, Balfrin)</a></li>
<li class="toctree-l2"><a class="reference internal" href="QuickStart.html#local-machines-and-containers">Local machines and Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="QuickStart.html#use-packages">Use packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="QuickStart.html#cosmo">COSMO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="C2SMGuidelines.html">C2SM Guidelines for Spack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="C2SMGuidelines.html#building">Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="C2SMGuidelines.html#running">Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="C2SMGuidelines.html#spack-in-scripts">Spack in scripts</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to manage your own Spack instance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-new-spack-instance">Create new Spack instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-spack-instance">Update Spack instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clean-spack-instance">Clean Spack instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spack-instance-config-files">Spack instance config files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SpackCommands.html">Important Spack Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-find">Spack find</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-list">Spack list</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-info">Spack info</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-spec">Spack spec</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-install">Spack install</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-installcosmo">Spack installcosmo</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-dev-build">Spack dev-build</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-devbuildcosmo">Spack devbuildcosmo</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-location">Spack location</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-build-env">Spack build-env</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-edit">Spack edit</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpackCommands.html#spack-load">Spack load</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Testing.html">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Testing.html#test-packages-pr-mr-ci-cd">Test packages (PR/MR/CI/CD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Testing.html#pull-request-testing-for-spack-c2sm-on-github">Pull Request Testing for spack-c2sm on GitHub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CodeDevelopment.html">Develop packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="CodeDevelopment.html#plain-dev-build">Plain dev-build</a></li>
<li class="toctree-l2"><a class="reference internal" href="CodeDevelopment.html#dev-build-in-combination-with-build-env">Dev-build in combination with build-env</a></li>
<li class="toctree-l2"><a class="reference internal" href="CodeDevelopment.html#environments-with-spack-develop">Environments with Spack develop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SpackChoice.html">Why was spack chosen by MeteoSwiss?</a></li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <section id="how-to-manage-your-own-spack-instance">
<h1>How to manage your own Spack instance<a class="headerlink" href="#how-to-manage-your-own-spack-instance" title="Permalink to this heading">¶</a></h1>
<p>Users are responsible for their own instance instead of relying
on an instance installed by C2SM. The main advantage is that the users
won’t have any change in their Spack instance, unless they actively
decide to pull upstream changes from GitHub.
Therefore your workflow is not interupted i.e. during a production phase
with using software installed by Spack.</p>
<p><strong>But with more power comes more responsability!</strong></p>
<p>This page collects best practices for a safe and reliable Spack instance management.</p>
<section id="create-new-spack-instance">
<h2>Create new Spack instance<a class="headerlink" href="#create-new-spack-instance" title="Permalink to this heading">¶</a></h2>
<p>To get an instance, git clone spack-c2sm and its submodule spack.
‘–depth 1’ and ‘–shallow-submodules’ are optional, but they reduce the amount of downloaded data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --depth <span class="m">1</span> --recurse-submodules --shallow-submodules -b dev_v0.18.1 https://github.com/C2SM/spack-c2sm.git
</pre></div>
</div>
<p>At CSCS setup-env.sh automatically detects the machine. You may simply execute</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> spack-c2sm/setup-env.sh
</pre></div>
</div>
<p>It is recommended to clone spack-c2sm in a location that does <strong>NOT</strong> undergo a
regular cleanup. On Piz Daint <code class="docutils literal notranslate"><span class="pre">$SCRATCH</span></code> enforces deletion of all files older than 30 days. This may corrupt your Spack instance, therefore <code class="docutils literal notranslate"><span class="pre">/project/XYZ/</span></code> is a safer location.</p>
</section>
<section id="update-spack-instance">
<h2>Update Spack instance<a class="headerlink" href="#update-spack-instance" title="Permalink to this heading">¶</a></h2>
<p>To update a spack instance, pull the latest version from the repository and update the submodule</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git pull
git submodule update --recursive
</pre></div>
</div>
<p>This is required after upgrades at CSCS or if you need new features of a package.
It is recommended to clean the instance afterwards, for more infos
see below.</p>
</section>
<section id="clean-spack-instance">
<h2>Clean Spack instance<a class="headerlink" href="#clean-spack-instance" title="Permalink to this heading">¶</a></h2>
<p>To clean a spack instance, empty the caches, uninstall everything and remove misc caches</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack clean -a
spack uninstall -a
rm -rf ~/.spack
</pre></div>
</div>
</section>
<section id="spack-instance-config-files">
<h2>Spack instance config files<a class="headerlink" href="#spack-instance-config-files" title="Permalink to this heading">¶</a></h2>
<p>There is a set of .yaml files that define machine specific things like compilers, modules, preinstalled packages
and more.</p>
<p>They are available under spack/etc/spack. Their structure is:</p>
<ul class="simple">
<li><p><strong>compilers.yaml</strong>: all info about available compilers, machine specific compiler flags, module to load (PrgEnv) before compiling</p></li>
<li><p><strong>packages.yaml</strong>: all info about the already installed dependencies, i.e their module names or paths</p></li>
<li><p><strong>modules.yaml</strong>: all info about the created modules, i.e which env variable or modules should be set once loaded</p></li>
<li><p><strong>config.yaml</strong>: specifies the main installation path and the main module installation path, where to find binaries etc.</p></li>
<li><p><strong>upstreams.yaml</strong>: specifies where to find the pre-installed software</p></li>
<li><p><strong>repos.yaml</strong>: specifies where to find the only mch packages that are stored in spack-c2sm repository</p></li>
</ul>
<p><strong>Unless your are a Spack developer you don’t need to modify any of the yaml-files listed!</strong></p>
</section>
</section>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sphinx_highlight.js"></script>
    <script type="text/javascript" src="_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright 2023, C2SM.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.
        </div>
    </div>  

</body>
</html>